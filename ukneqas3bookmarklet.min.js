javascript:!function(){if(document.getElementById("hlaUploadBtn"))return;let e=[{min:0,max:1999,text:"0-1,999"},{min:2e3,max:4999,text:"2,000-4,999"},{min:5e3,max:9999,text:"5,000-9,999"},{min:1e4,max:14999,text:"10,000-14,999"},{min:15e3,max:19999,text:"15,000-19,999"},{min:2e4,max:24999,text:"20,000-24,999"},{min:25e3,max:1/0,text:"≥25,000"}],t=document.createElement("button");t.id="hlaUploadBtn",t.textContent="\uD83D\uDCC4 Upload a CSV File",Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",zIndex:9999,padding:"8px 12px",fontSize:"14px",background:"#265449",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"});let n=document.createElement("input");n.type="file",n.accept=".csv",n.style.display="none",n.addEventListener("change",function(){let t=n.files[0];if(!t)return;let l=new FileReader;l.onload=function(t){let l=t.target.result.split(/\r?\n/).filter(Boolean),r=l.map(e=>{let t=e.split(",");if(t.length<2)return null;let n=t[0].trim(),l=parseInt(t[1].replace(/,/g,"")),r=t[2]&&"1"===t[2].trim();return{hla:n,mfi:l,unacceptable:r}}).filter(Boolean);r.forEach(({hla:t,mfi:n,unacceptable:l})=>{let r=Array.from(document.querySelectorAll('input[type="hidden"][id="HLA"]')).find(e=>e.value.toLowerCase()===t.toLowerCase());if(!r)return;let i=r.name.replace(/\[HLA\]$/,""),a=document.querySelector(`input[name="${i}[PRESENT]"]`),o=document.querySelector(`select[name="${i}[MFI]"]`),c=document.querySelector(`input[name="${i}[UNACCEPTABLEANTIGENLISTING]"]`);if(a&&(a.checked=!0),o){let d=e.find(e=>n>=e.min&&n<=e.max);d&&(Array.from(o.options).forEach(e=>{e.selected=e.text===d.text}),o.dispatchEvent(new Event("change",{bubbles:!0})))}c&&(c.checked=l)}),n.remove(),setTimeout(()=>{(function e(){let t=document.createElement("button");t.id="hlaDownloadBtn",t.textContent="⬇️ Download as CSV File",Object.assign(t.style,{position:"fixed",top:"60px",right:"20px",zIndex:9999,padding:"8px 12px",fontSize:"14px",background:"#265449",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"}),t.addEventListener("click",()=>{let e=Array.from(document.querySelectorAll("tr")),t=[["HLA","MFI","UNACCEPTABLE"]];e.forEach(e=>{let n=e.querySelector('input[type="hidden"][id="HLA"]');if(!n)return;let l=n.name.replace(/\[HLA\]$/,""),r=document.querySelector(`input[name="${l}[PRESENT]"]`);if(!r||!r.checked)return;let i=document.querySelector(`select[name="${l}[MFI]"]`),a=document.querySelector(`input[name="${l}[UNACCEPTABLEANTIGENLISTING]"]`),o=n.value,c=i?i.selectedOptions[0].text:"",d=a&&a.checked?"1":"0";t.push([`"${o}"`,`"${c}"`,d])});let n=t.map(e=>e.join(",")).join("\n"),l=document.querySelector("h2.zfaces-form-label"),r="hla_output.csv";if(l){let i=l.textContent.match(/Sample\s+[\w/]+/);i&&(r=i[0]+".csv")}let a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=r,o.click()}),document.body.appendChild(t)})(),alert("HLA antibody data applied!")},200)},l.readAsText(t)}),t.addEventListener("click",()=>n.click()),document.body.appendChild(t),document.body.appendChild(n)}();