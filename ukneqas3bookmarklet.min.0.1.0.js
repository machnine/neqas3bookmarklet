javascript:!function(){if(document.getElementById("hlaUploadBtn"))return;let e=[{min:0,max:1999,text:"0-1,999"},{min:2e3,max:4999,text:"2,000-4,999"},{min:5e3,max:9999,text:"5,000-9,999"},{min:1e4,max:14999,text:"10,000-14,999"},{min:15e3,max:19999,text:"15,000-19,999"},{min:2e4,max:24999,text:"20,000-24,999"},{min:25e3,max:1/0,text:"≥25,000"}],t=document.createElement("button");t.id="hlaUploadBtn",t.textContent="\uD83D\uDCC4 Upload HLA CSV",Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",zIndex:9999,padding:"8px 12px",fontSize:"14px",background:"#265449",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"});let n=document.createElement("input");n.type="file",n.accept=".csv",n.style.display="none",n.addEventListener("change",function(){let r=n.files[0];if(!r)return;let l=new FileReader;l.onload=function(r){let l=r.target.result.split(/\r?\n/).filter(Boolean),i=l.map(e=>{let t=e.split(",");if(t.length<2)return null;let n=t[0].trim(),r=parseInt(t[1].replace(/,/g,"")),l=t[2]&&"1"===t[2].trim();return{hla:n,mfi:r,unacceptable:l}}).filter(Boolean);i.forEach(({hla:t,mfi:n,unacceptable:r})=>{let l=Array.from(document.querySelectorAll('input[type="hidden"][id="HLA"]')).find(e=>e.value.toLowerCase()===t.toLowerCase());if(!l)return;let i=l.name.replace(/\[HLA\]$/,""),o=document.querySelector(`input[name="${i}[PRESENT]"]`),a=document.querySelector(`select[name="${i}[MFI]"]`),c=document.querySelector(`input[name="${i}[UNACCEPTABLEANTIGENLISTING]"]`);if(o&&(o.checked=!0),a){let d=e.find(e=>n>=e.min&&n<=e.max);d&&(Array.from(a.options).forEach(e=>{e.selected=e.text===d.text}),a.dispatchEvent(new Event("change",{bubbles:!0})))}c&&(c.checked=r)}),t.remove(),n.remove(),setTimeout(()=>{(function e(){let t=document.createElement("button");t.id="hlaDownloadBtn",t.textContent="⬇️ Download Processed Data",Object.assign(t.style,{position:"fixed",top:"60px",right:"20px",zIndex:9999,padding:"8px 12px",fontSize:"14px",background:"#265449",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"}),t.addEventListener("click",()=>{let e=Array.from(document.querySelectorAll("tr")),t=[["HLA","MFI","UNACCEPTABLE"]];e.forEach(e=>{let n=e.querySelector('input[type="hidden"][id="HLA"]');if(!n)return;let r=n.name.replace(/\[HLA\]$/,""),l=document.querySelector(`input[name="${r}[PRESENT]"]`);if(!l||!l.checked)return;let i=document.querySelector(`select[name="${r}[MFI]"]`),o=document.querySelector(`input[name="${r}[UNACCEPTABLEANTIGENLISTING]"]`),a=n.value,c=i?i.selectedOptions[0].text:"",d=o&&o.checked?"1":"0";t.push([`"${a}"`,`"${c}"`,d])});let n=t.map(e=>e.join(",")).join("\n"),r=document.querySelector("h2.zfaces-form-label"),l="hla_output.csv";if(r){let i=r.textContent.match(/Sample\s+[\w/]+/);i&&(l=i[0]+".csv")}let o=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=l,a.click()}),document.body.appendChild(t)})(),alert("HLA data applied!")},200)},l.readAsText(r)}),t.addEventListener("click",()=>n.click()),document.body.appendChild(t),document.body.appendChild(n)}();